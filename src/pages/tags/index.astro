---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog', ({ data }) => !data.draft);

const tags = [...new Set(posts.flatMap((post) => post.data.tags))].sort();

function getPostCountForTag(tag: string) {
  return posts.filter((post) => post.data.tags.includes(tag)).length;
}
---

<BaseLayout title="Tags" description="Browse posts by tag">
  <h1 class="text-3xl font-bold mb-8">Tags</h1>

  {tags.length === 0 ? (
    <p class="text-slate-500">No tags yet.</p>
  ) : (
    <div class="flex flex-wrap gap-3">
      {tags.map((tag) => (
        <a
          href={`/tags/${tag}`}
          class="px-4 py-2 bg-slate-100 hover:bg-slate-200 rounded-full text-sm font-medium transition-colors"
        >
          #{tag}
          <span class="ml-1 text-slate-500">({getPostCountForTag(tag)})</span>
        </a>
      ))}
    </div>
  )}
</BaseLayout>
