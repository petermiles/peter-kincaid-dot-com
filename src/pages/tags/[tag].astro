---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => !data.draft);
  const tags = [...new Set(posts.flatMap((post) => post.data.tags))];

  return tags.map((tag) => ({
    params: { tag },
    props: {
      posts: posts
        .filter((post) => post.data.tags.includes(tag))
        .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf()),
    },
  }));
}

const { tag } = Astro.params;
const { posts } = Astro.props;

function formatDate(date: Date) {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
  });
}
---

<BaseLayout title={`Posts about ${tag}`} description={`Posts about ${tag}`}>
  <p class="text-sm mb-2" style="color: var(--color-brown-lighter);">
    <a href="/tags">‚Üê All topics</a>
  </p>
  <h1 class="text-2xl md:text-3xl mb-10" style="font-weight: normal;">
    {tag}
  </h1>

  <ul class="space-y-8">
    {posts.map((post) => (
      <li>
        <a href={`/blog/${post.id.replace(/\.md$/, '')}`} class="block group">
          <span class="text-sm" style="color: var(--color-brown-lighter);">
            {formatDate(post.data.date)}
          </span>
          <h2 class="text-xl mt-1 group-hover:opacity-70 transition-opacity" style="font-weight: normal; color: var(--color-brown);">
            {post.data.title}
          </h2>
        </a>
      </li>
    ))}
  </ul>
</BaseLayout>
