---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

function formatDate(date: Date) {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  });
}
---

<BaseLayout title="Blog" description="All blog posts by Peter Kincaid">
  <h1 class="text-3xl font-bold mb-8">Blog</h1>

  {posts.length === 0 ? (
    <p class="text-slate-500">No posts yet. Check back soon!</p>
  ) : (
    <ul class="space-y-8">
      {posts.map((post) => (
        <li>
          <a href={`/blog/${post.id.replace(/\.md$/, '')}`} class="group block">
            <article>
              <h2 class="text-xl font-semibold group-hover:text-blue-600 transition-colors">
                {post.data.title}
              </h2>
              <p class="text-slate-600 mt-2">{post.data.description}</p>
              <div class="flex flex-wrap items-center gap-3 mt-3 text-sm">
                <time class="text-slate-400">
                  {formatDate(post.data.date)}
                </time>
                {post.data.tags.length > 0 && (
                  <div class="flex gap-2">
                    {post.data.tags.map((tag) => (
                      <span class="text-blue-600">#{tag}</span>
                    ))}
                  </div>
                )}
              </div>
            </article>
          </a>
        </li>
      ))}
    </ul>
  )}
</BaseLayout>
